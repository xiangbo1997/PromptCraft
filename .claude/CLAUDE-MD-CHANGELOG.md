# CLAUDE.md 修改对照文档

**修改时间**：2025-12-13
**修改文件**：`~/.claude/CLAUDE.md`
**参照来源**：[steipete/agent-rules](https://github.com/steipete/agent-rules)

---

## 一、整体变化概览

| 指标 | 修改前 | 修改后 | 变化 |
|------|--------|--------|------|
| 总行数 | 348 行 | 340 行 | -8 行 |
| 章节数 | 9 章（含子章节 20+） | 9 章 + 附录 | 结构更清晰 |
| 表格数量 | 15+ 个大表格 | 3 个精简表格 | 大幅减少 |
| 代码块 | 0 个 | 6 个 | 新增实用示例 |

---

## 二、章节结构对比

### 修改前结构
```
0. 角色定位与职责边界（表格）
1. 工具能力总览
   1.1 内置工具（表格）
   1.2 外部工具 MCP（大表格）
2. 约束优先级（表格）
2.5 强制前置流程（表格）
3. 工作流程（4 阶段）
   阶段 0：需求理解与上下文收集（详细子步骤）
   阶段 1：任务规划
   阶段 2：代码执行
   阶段 3：质量验证
4. 编码策略（表格）
4.5 Git Commit 规范 ← 本次新增
5. 测试与验证（表格）
6. 文档策略（表格）
7. 工具协作与降级（表格）
8. 开发哲学（表格）
9. 行为准则（表格）
```

### 修改后结构
```
1. 核心原则
   1.1 角色定位（列表）
   1.2 开发哲学（列表）← 新增
   1.3 简单性定义（列表）← 新增
2. 工具能力
   2.1 内置工具（精简表格）
   2.2 MCP 工具优先级（有序列表）
   2.3 工具使用规则（列表）
3. 工作流程
   3.1 标准流程（代码块）
   3.2 上下文收集（精简）
   3.3 任务规划
   3.4 代码执行
   3.5 质量验证
4. 编码规范
   4.1 核心规则（列表）
   4.2 安全规范（列表）← 独立章节
   4.3 项目集成（列表）← 新增
5. Git Commit 规范（保留）
6. 代码质量 ← 全新章节
   6.1 检查流程 /check
   6.2 清理流程 /clean
   6.3 代码分析维度
7. 测试策略（精简）
8. 行为准则（精简）
9. 文档规范（精简）
附录：常用工作流命令 ← 新增
```

---

## 三、详细变更内容

### 3.1 删除的内容

#### ❌ 删除：冗余的表格格式
**修改前**（示例）：
```markdown
| instruction | notes |
|-------------|-------|
| Claude Code 负责任务规划、代码编写... | 保持全栈能力 |
| 职责范围：需求分析、技术方案设计... | 承担完整开发生命周期 |
```

**修改后**：改为简洁列表
```markdown
- 负责完整开发生命周期：需求分析 → 技术设计 → 代码实现 → 测试验证 → 文档编写
- 自主决策技术方案与实现细节，仅在真正需要用户输入时才询问
```

#### ❌ 删除：过于详细的上下文收集步骤
**修改前**：
- 步骤 1：结构化快速扫描（必须）- 输出到 `.claude/context-scan.json`
- 步骤 2：识别关键疑问（必须）- 使用 Sequential Thinking 分析
- 步骤 3：针对性深挖（按需，建议 ≤3 次）
- 步骤 4：充分性检查（必须）
- 回溯补充机制
- 禁止事项

**修改后**：精简为 4 点
```markdown
1. **快速扫描**：定位功能模块、技术栈、现有测试
2. **识别疑问**：已知/未知/优先级
3. **针对性深挖**：≤3 次，聚焦单个疑问
4. **充分性检查**：[检查清单]
```

#### ❌ 删除：重复的 MCP 工具详细说明表格
**修改前**：一个 8 行 3 列的大表格，详细描述每个 MCP 服务器

**修改后**：改为有序列表，按优先级排列
```markdown
1. **思考与规划**：Sequential Thinking（强制前置）
2. **内部检索**：Desktop Commander `start_search` → Grep/Glob
...
```

#### ❌ 删除：独立的"开发哲学"章节（第 8 章）
内容合并到新的 **1.2 开发哲学** 和 **1.3 简单性定义**

#### ❌ 删除：独立的"工具协作与降级"章节（第 7 章）
内容合并到 **2.2 MCP 工具优先级** 和 **2.3 工具使用规则**

---

### 3.2 新增的内容

#### ✅ 新增：1.2 开发哲学
```markdown
- **简单优于复杂**：偏向简单方案，避免过度架构
- **实用主义**：务实优先，满足真实需求
- **可读性优先**：选择表达清晰的实现，拒绝炫技写法
- **小步快跑**：渐进式迭代，保持每次改动可编译、可验证
- **学习优先**：实现前研读既有代码或文档，吸收经验
```

#### ✅ 新增：1.3 简单性定义
```markdown
- 单一职责
- 三次重复后再抽象
- 不用"聪明"技巧
- 若需额外解释，继续简化
```

#### ✅ 新增：4.3 项目集成
```markdown
- 寻找至少 3 个相似特性/组件，理解设计与复用
- 沿用项目通用模式与约定
- 使用既有构建系统和测试框架
- 使用项目格式化/静态检查设置
```

#### ✅ 新增：第 6 章 代码质量（全新）
```markdown
### 6.1 检查流程（/check）
1. 运行项目检查命令
2. 分析输出，识别错误和警告
3. 按优先级修复问题
4. 重新验证直到通过

### 6.2 清理流程（/clean）
**Python 项目**：
black . / isort . / flake8 . / mypy .

**JavaScript/TypeScript 项目**：
npx prettier --write . / npx eslint . --fix / npx tsc --noEmit

### 6.3 代码分析维度
- 结构分析 / 质量分析 / 安全分析 / 性能分析 / 测试分析
```

#### ✅ 新增：附录 - 常用工作流命令
1. **问题分析模板**：Issue Summary / Problem Statement / Technical Approach / Implementation Plan / Test Plan / Files to Modify / Success Criteria
2. **Bug 修复流程**：7 步标准流程
3. **Changelog 格式**：Keep a Changelog 标准

---

### 3.3 保留的内容

#### ✓ 完整保留：Git Commit 规范（第 5 章）
- 提交类型表格
- 提交格式
- 示例
- 约束规则

#### ✓ 保留并精简：行为准则（第 8 章）
- 自主决策（默认执行）列表
- 需要确认（极少数例外）列表
- 核心约束

#### ✓ 保留核心：测试策略、文档规范
精简为要点列表

---

## 四、风格变化对比

### 4.1 表格 → 列表

**修改前**：
```markdown
| instruction | notes |
|-------------|-------|
| 渐进式迭代，保持每次改动可编译、可验证 | 小步快跑 |
| 实现前研读既有代码或文档，吸收经验 | 学习优先 |
```

**修改后**：
```markdown
- **小步快跑**：渐进式迭代，保持每次改动可编译、可验证
- **学习优先**：实现前研读既有代码或文档，吸收经验
```

### 4.2 添加分隔线

每个主要章节之间使用 `---` 分隔，提高可读性

### 4.3 添加代码块

新增 6 个代码块展示：
- 标准工作流程
- Git commit 格式和示例
- Python/JS 清理命令
- 问题分析模板
- Changelog 格式

---

## 五、参照 steipete/agent-rules 的改进点

| 改进点 | 来源 | 实现 |
|--------|------|------|
| 简洁的列表格式 | agent-rules 整体风格 | 去除大部分表格 |
| 开发哲学章节 | modern-swift.mdc | 新增 1.2 开发哲学 |
| 简单性定义 | agent-rules README | 新增 1.3 简单性定义 |
| /check 流程 | check.mdc | 新增 6.1 检查流程 |
| /clean 流程 | clean.mdc | 新增 6.2 清理流程 |
| 代码分析维度 | code-analysis.mdc | 新增 6.3 代码分析维度 |
| 问题分析模板 | analyze-issue.mdc | 新增附录 |
| Bug 修复流程 | bug-fix.mdc | 新增附录 |
| Changelog 格式 | add-to-changelog.mdc | 新增附录 |
| 项目集成原则 | agent-rules README | 新增 4.3 项目集成 |

---

## 六、总结

### 主要改进
1. **结构更清晰**：从冗长表格改为简洁列表
2. **内容更实用**：新增代码质量流程和工作流模板
3. **风格更现代**：参照 steipete/agent-rules 的最佳实践
4. **保留核心**：Git Commit 规范、安全约束、行为准则完整保留

### 建议后续
- 可根据实际使用情况继续调整
- 项目级 CLAUDE.md 可按需同步更新
